---
- name: Deprovision VM
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Include vSphere datacenter creds
      ansible.builtin.include_vars:
        file: ../vault_files/vsphere_creds.yml

    - name: Include deprovision VM vars
      ansible.builtin.include_vars:
        file: vars/deprovision_vm_vars.yml

    - name: Deprovision a VM
      ansible.builtin.import_role:
        name: provision_vm
      vars:
        provision_vm_hostname: "{{ vCenter_hostname }}"
        provision_vm_username: "{{ vCenter_username }}"
        provision_vm_password: "{{ vCenter_password }}"

    - name: Verify that VM is absent
      ansible.builtin.include_tasks:
        file: post_validations/verify_vm_deprovisioning.yml
