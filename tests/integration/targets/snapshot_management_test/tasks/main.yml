---
- name: Import vars
  ansible.builtin.include_vars:
    file: vars.yml

- name: Provision VM
  ansible.builtin.import_role:
    name: cloud.vmware_ops.provision_vm
  vars:
    provision_vm_name: "{{ vm_name }}"
    provision_vm_disk:
    - size_gb: 10
      type: thin
      datastore: "datastore1"
    provision_vm_hardware:
      memory_mb: 512
      num_cpus: 4
    provision_vm_guest_id: "centos64Guest"

- name: Create VM snapshot
  ansible.builtin.import_role:
    name: cloud.vmware_ops.snapshot_management
  vars:
    snapshot_management_vm_name: "{{ vm_name }}"
    snapshot_management_state: present
    snapshot_management_snapshot_name: "snap1"
    snapshot_management_snapshot_description: "snap1_description"

- name: Remove VM snapshot
  ansible.builtin.import_role:
    name: cloud.vmware_ops.snapshot_management
  vars:
    snapshot_management_vm_name: "{{ vm_name }}"
    snapshot_management_state: absent
    snapshot_management_snapshot_name: "snap1"

- name: Remove VM
  ansible.builtin.import_role:
    name: cloud.vmware_ops.provision_vm
  vars:
    provision_vm_name: "{{ vm_name }}"
    provision_vm_state: "absent"